<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>BeatBlock Browser</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="style.css" media="screen"/>
    <script>
        /**
         * Automatically replaces the header id with the header navbar,
         * and the footer id with the footer.
         * Prevents me having to write the same code on a bunch of pages.
         */
        $(document).ready(function () {
            $('#navbar').load('navbar.html');
            $('#searchbar').load('searchbar.html');
        });
    </script>
</head>
<body>
<div id="navbar"></div>
<div id="searchbar"></div>

<!-- Main Content Start -->
<div class="container mt-5">
    <!-- Search Query Display -->
    <div class="row mb-4">
        <div class="col">
            <h2>Search Results for: <span id="search-query"></span></h2>
            <hr>
        </div>
    </div>

    <!-- Search Results Container -->
    <div id="search-results" class="row">
        <!-- Search results will be inserted here -->
    </div>

    <!-- No Results Message -->
    <div id="no-results" class="row" style="display: none;">
        <div class="col">
            <p>No results found for your search.</p>
        </div>
    </div>
</div>
<!-- Main Content End -->

<!-- Search Result Template -->
<template id="search-result-template">
    <div class="col-md-6">
        <div class="card mb-4">
            <div class="row g-0">
                <!-- Thumbnail Image -->
                <div class="col-md-4">
                    <img src="https://via.placeholder.com/150" class="img-fluid rounded-start" alt="Beat Map Thumbnail">
                </div>
                <div class="col-md-8">
                    <div class="card-body">
                        <h5 class="card-title">Beat Map Title</h5>
                        <p class="card-text"><strong>Artist:</strong> Artist Name</p>
                        <p class="card-text"><strong>Difficulty:</strong> Easy</p>
                        <a href="#" class="btn btn-primary">Play</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</template>

<!-- Custom JavaScript to Handle Search Results -->
<script>
    // Function to display search results
    async function displaySearchResults(params) {
        const resultsContainer = document.getElementById('search-results');
        const noResultsContainer = document.getElementById('no-results');
        const template = document.getElementById('search-result-template');

        try {
            // Show a loading indicator (optional)
            resultsContainer.innerHTML = '<p>Loading results...</p>';
            noResultsContainer.style.display = 'none';

            // Fetch data from the /api/search endpoint
            const response = await fetch(`/api/search${params}`, {
                method: 'GET',
                headers: {
                    'Accept': 'application/json'
                }
            });

            if (!response.ok) {
                throw new Error(`Server error: ${response.status} ${response.statusText}`);
            }

            const beatMaps = await response.json();

            // Clear previous results
            resultsContainer.innerHTML = '';

            if (beatMaps.length > 0) {
                noResultsContainer.style.display = 'none';

                beatMaps.forEach(map => {
                    // Clone the template
                    const clone = template.content.cloneNode(true);

                    // Populate the clone with actual data
                    clone.querySelector('.card-title').textContent = map.song;
                    clone.querySelector('.card-text strong').textContent = "Artist:";
                    clone.querySelectorAll('.card-text')[0].innerHTML = `<strong>Artist:</strong> ${map.author}`;
                    clone.querySelectorAll('.card-text')[1].innerHTML = `<strong>Difficulty:</strong> ${map.difficulty || 'N/A'}`;
                    clone.querySelector('img').src = map.thumbnail || 'default-thumbnail.jpg';
                    clone.querySelector('a.btn').href = map.link || '#';

                    // Append the clone to the results container
                    resultsContainer.appendChild(clone);
                });
            } else {
                // No results found
                noResultsContainer.style.display = 'block';
                resultsContainer.innerHTML = '';
            }
        } catch (error) {
            console.error('Error fetching search results:', error);
            resultsContainer.innerHTML = '<p>An error occurred while fetching search results. Please try again later.</p>';
            noResultsContainer.style.display = 'none';
        }
    }

    // Initialize search results on page load
    document.addEventListener('DOMContentLoaded', function() {
        displaySearchResults(window.location.search);
    });
</script>
</body>
</html>